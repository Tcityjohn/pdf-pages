# Grandma's Guidance

Last reviewed: 2026-01-17T16:45:00Z
Last story reviewed: PDF-004

---

## Current Assessment

**4 of 18 stories completed.** Project is on track. PDF-001 through PDF-004 all passed with good quality.

Current codebase state:
- `lib/main.dart` - HomePage with file picker, shows page count after loading
- `lib/core/services/pdf_service.dart` - PdfService with loadPdf(), closeDocument()
- PdfService keeps `currentDocument` reference for thumbnail generation

## Guidance for PDF-005: Thumbnail Generation

**This is your next story.** Here's exactly how to implement it:

### The pdfx Render API

```dart
// 1. Get a page (1-indexed!)
final page = await document.getPage(pageNumber); // pageNumber starts at 1

// 2. Render to image
final pageImage = await page.render(
  width: 150,  // target width in pixels
  height: 212, // ~1.4 aspect ratio for A4
  format: PdfPageImageFormat.png,
);

// 3. Get bytes
final Uint8List bytes = pageImage!.bytes;

// 4. Close the page to free memory
await page.close();
```

### Implementation Steps

1. **Add method to PdfService** (`lib/core/services/pdf_service.dart`):
```dart
import 'dart:typed_data';

/// Generates a thumbnail for the given page number (1-indexed)
/// Returns PNG bytes at 150px width
Future<Uint8List> generateThumbnail(int pageNumber) async {
  if (_currentDocument == null) {
    throw PdfLoadException('No document loaded');
  }

  final page = await _currentDocument!.getPage(pageNumber);
  try {
    // Render at 150px width, ~1.4 aspect ratio for A4
    final pageImage = await page.render(
      width: 150,
      height: 212,
      format: PdfPageImageFormat.png,
    );
    return pageImage!.bytes;
  } finally {
    await page.close(); // Always close to free memory
  }
}
```

2. **Import needed types** at top of pdf_service.dart:
```dart
import 'dart:typed_data';
```

3. **That's it!** Don't integrate with UI yet - just add the method to the service.

### Acceptance Criteria Checklist
- [ ] generateThumbnail() method renders page at 150px width
- [ ] Thumbnails maintain correct aspect ratio (~1.4 for A4)
- [ ] Returns Uint8List (PNG bytes)
- [ ] Generation is async (it already is with await)
- [ ] Memory: close page after rendering

### Testing
- Run `flutter analyze` - should have no issues
- Run `flutter build ios --simulator` - should succeed
- No need to test in Simulator UI for this story - just verify the method exists and code compiles

### Don't Over-Engineer
- Don't add caching yet
- Don't integrate with UI yet (that's PDF-007)
- Don't create thumbnail widgets yet
- Just add the one method to PdfService

---

## Patterns for This Project

- Primary color: `Color(0xFFE53935)`
- pdfx uses 1-indexed pages
- Always close PdfPage after use to free memory
- iOS deployment target: 14.0

---

## History

| Story | Status | Notes |
|-------|--------|-------|
| PDF-001 | ✅ Pass | Project scaffolding |
| PDF-002 | ✅ Pass | iOS permissions |
| PDF-003 | ✅ Pass | File picker |
| PDF-004 | ✅ Pass | PDF loading service |

---

*Guidance updated: 2026-01-17T16:45:00Z*
